# Backend Environment Variables Template

# ============================================================================
# MINDBRIDGE BACKEND ENVIRONMENT CONFIGURATION
# ============================================================================
# Copy this file to .env and fill in the values
# NEVER commit .env to git - it's in .gitignore
# ============================================================================

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================
NODE_ENV=development
PORT=5004
API_VERSION=v1
APP_NAME=MindBridge
BASE_URL=http://localhost:5004

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# MongoDB Connection
# Local: mongodb://localhost:27017/mindbridge
# Atlas: mongodb+srv://username:password@cluster.mongodb.net/mindbridge
MONGODB_URI=mongodb://localhost:27017/mindbridge
MONGODB_DB_NAME=mindbridge

# ============================================================================
# AUTHENTICATION & SECURITY
# ============================================================================
# JWT Configuration
# Generate strong secrets: openssl rand -hex 32
JWT_SECRET=your-super-secret-key-change-this-in-production-min-32-chars
JWT_REFRESH_SECRET=your-refresh-secret-change-this-in-production-min-32
JWT_EXPIRE=15m
JWT_REFRESH_EXPIRE=7d

# Password Hashing
BCRYPT_ROUNDS=10

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000          # 15 minutes
RATE_LIMIT_MAX_REQUESTS=100          # per window

# Session Configuration (if using sessions instead of JWT)
SESSION_SECRET=your-session-secret-min-32-chars

# ============================================================================
# EXTERNAL API KEYS & INTEGRATIONS
# ============================================================================

# --- LLM / AI PROVIDER (choose one or configure multiple) ---

# OpenAI Configuration
OPENAI_API_KEY=sk-your-openai-key-here
OPENAI_MODEL=gpt-4                          # gpt-4, gpt-3.5-turbo, etc.
OPENAI_EMBEDDINGS_MODEL=text-embedding-3-small
OPENAI_MAX_TOKENS=500
OPENAI_TEMPERATURE=0.7
OPENAI_REQUEST_TIMEOUT=30000                # 30 seconds

# ============================================================================
# CHATBOT AI CONFIGURATION (for elderly companion chatbot)
# ============================================================================
# Select ONE model for the chatbot: 'gemini' or 'groq'
AI_MODEL=gemini                             # 'gemini' or 'groq'

# Google Gemini API (Recommended for elderly-friendly responses)
# Get API key from: https://ai.google.dev
# Free tier available, great for conversational AI
GEMINI_API_KEY="AIzaSyBLy5iPfcPdTjEvf5vqvw8e2Y_NCD7pZh8"

# Groq API (Alternative: faster inference, free tier)
# Get API key from: https://console.groq.com
# Models available: llama-3.3-70b-versatile, llama-3.1-70b-versatile, etc.
GROQ_API_KEY=gsk-your-groq-key-here
GROQ_MODEL=llama-3.3-70b-versatile

# ============================================================================
# LEGACY LLM CONFIGURATION (kept for backwards compatibility)
# ============================================================================

# Alternative: Groq (faster, cheaper than OpenAI)
# GROQ_API_KEY=gsk-your-groq-key-here
# GROQ_MODEL=llama-3.3-70b-versatile

# Alternative: Google Gemini
# GEMINI_API_KEY=AIzaSy-your-gemini-key
# GEMINI_MODEL=gemini-pro

# --- Telegram Bot Configuration ---
TELEGRAM_BOT_TOKEN=123456789:ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefgh
TELEGRAM_BOT_API_URL=https://api.telegram.org/bot
TELEGRAM_WEBHOOK_URL=https://yourdomain.com/api/v1/alerts/telegram-callback  # For webhooks

# --- Google Maps (optional, for geolocation enrichment) ---
GOOGLE_MAPS_API_KEY=AIzaSy-your-google-maps-key

# --- Email Service Configuration ---
MAIL_PROVIDER=sendgrid                      # "sendgrid", "nodemailer", "aws-ses"
SENDGRID_API_KEY=SG.your-sendgrid-key
MAIL_FROM=noreply@mindbridge.io
MAIL_FROM_NAME=MindBridge Alerts

# Alternative: Nodemailer
# NODEMAILER_HOST=smtp.gmail.com
# NODEMAILER_PORT=587
# NODEMAILER_USER=your-email@gmail.com
# NODEMAILER_PASS=your-app-password

# ============================================================================
# FILE STORAGE CONFIGURATION
# ============================================================================
FILE_STORAGE_TYPE=local                     # "local" or "s3"
UPLOAD_DIR=./uploads
MAX_UPLOAD_SIZE=10485760                    # 10 MB in bytes
ALLOWED_FILE_TYPES=pdf,doc,docx,txt,json

# AWS S3 Configuration (if FILE_STORAGE_TYPE=s3)
AWS_S3_BUCKET=mindbridge-uploads
AWS_S3_REGION=us-east-1
AWS_S3_BUCKET_URL=https://mindbridge-uploads.s3.amazonaws.com
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_LEVEL=debug                             # "debug", "info", "warn", "error"
LOG_DIR=./logs
LOG_FORMAT=combined                         # "combined", "common", "dev"
LOG_FILE_MAX_SIZE=10m
LOG_FILES_MAX=5                             # Keep 5 log files max
LOG_TO_FILE=true
LOG_TO_CONSOLE=true

# ============================================================================
# CORS & SECURITY
# ============================================================================
CORS_ORIGIN=http://localhost:5173,http://localhost:3000
CORS_CREDENTIALS=true
CORS_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_HEADERS=Content-Type,Authorization,X-Requested-With

# ============================================================================
# REDIS CACHE (optional for caching & Socket.io)
# ============================================================================
REDIS_ENABLED=false
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_CACHE_TTL=3600                       # 1 hour default TTL

# ============================================================================
# SOCKET.IO CONFIGURATION (real-time alerts)
# ============================================================================
SOCKET_IO_ENABLED=true
SOCKET_IO_CORS_ORIGIN=http://localhost:5173
SOCKET_IO_PING_TIMEOUT=5004
SOCKET_IO_HEARTBEAT_INTERVAL=25004

# ============================================================================
# AI MODEL PARAMETERS
# ============================================================================

# --- Chatbot Settings ---
CHATBOT_TEMPERATURE=0.7                     # 0-1 (higher = more creative)
CHATBOT_MAX_TOKENS=500
CHATBOT_SYSTEM_PROMPT="You are MindBridge, a compassionate AI companion for elderly users. You engage in warm, thoughtful conversations while gently monitoring for any signs of confusion or distress."
CHATBOT_MEMORY_CONTEXT_LENGTH=5             # Number of previous messages to include

# --- Cognitive Engine Settings ---
COGNITIVE_ENGINE_DRIFT_THRESHOLD=0.65       # 0-1 score
COGNITIVE_ENGINE_ALERT_ON_HIGH_DRIFT=true
COGNITIVE_ENGINE_ANALYSIS_INTERVAL=300000   # 5 minutes
COGNITIVE_ENGINE_MIN_MESSAGES_FOR_ANALYSIS=3

# ============================================================================
# RAG (Retrieval-Augmented Generation) CONFIGURATION
# ============================================================================
RAG_ENABLED=true
RAG_CHUNK_SIZE=500                          # Characters per chunk
RAG_CHUNK_OVERLAP=100
RAG_TOP_K_RESULTS=5                         # Number of memories to retrieve
RAG_SIMILARITY_THRESHOLD=0.7                # 0-1 minimum relevance
RAG_EMBEDDING_MODEL=text-embedding-3-small

# ============================================================================
# GEOFENCE CONFIGURATION
# ============================================================================
GEOFENCE_ENABLED=true
GEOFENCE_DEFAULT_RADIUS_M=500               # Default zone radius in meters
GEOFENCE_CHECK_INTERVAL_MS=60000            # Check location every 1 minute
GEOFENCE_ACCURACY_THRESHOLD_M=50            # Ignore location updates with worse accuracy

# ============================================================================
# ALERT SETTINGS
# ============================================================================
ALERT_TELEGRAM_ENABLED=true
ALERT_EMAIL_ENABLED=false
ALERT_SMS_ENABLED=false
ALERT_PUSH_ENABLED=false

# Alert thresholds
ALERT_CRITICAL_COOLDOWN_MS=300000           # 5 minutes (prevent alert spam)
ALERT_WARNING_COOLDOWN_MS=600000            # 10 minutes
ALERT_INFO_COOLDOWN_MS=1800000              # 30 minutes

# Alert routing
ALERT_ENABLE_ESCALATION_CHAIN=true          # Notify backup caregiver if primary doesn't ACK
ALERT_ESCALATION_TIMEOUT_MS=600000          # 10 minutes before escalating

# ============================================================================
# DOCTOR REPORTS CONFIGURATION
# ============================================================================
DOCTOR_REPORT_ENABLED=true
DOCTOR_REPORT_EXPORT_FORMAT=pdf             # "pdf" or "json"
DOCTOR_REPORT_INCLUDE_CONVERSATIONS=false   # Include full conversations (privacy concern)
DOCTOR_REPORT_INCLUDE_METRICS=true
DOCTOR_REPORT_INCLUDE_RISK_EVENTS=true
DOCTOR_REPORT_DEFAULT_PERIOD_DAYS=90

# ============================================================================
# FEATURE FLAGS
# ============================================================================
FEATURE_VOICE_ENABLED=true
FEATURE_RAG_ENABLED=true
FEATURE_GEOFENCE_ENABLED=true
FEATURE_COGNITIVE_ENGINE_ENABLED=true
FEATURE_TELEGRAM_ALERTS_ENABLED=true
FEATURE_EMAIL_NOTIFICATIONS_ENABLED=false
FEATURE_SMS_NOTIFICATIONS_ENABLED=false

# ============================================================================
# DEVELOPMENT ONLY
# ============================================================================
DEBUG=mindbridge:*                          # Enable verbose logging
SEED_DATABASE=false                         # Auto-seed test data on startup
MOCK_EXTERNAL_APIS=false                    # Use mocks instead of real APIs
DISABLE_RATE_LIMITING=false                 # Disable for testing
DISABLE_AUTHENTICATION=false                # NEVER set to true in production
VERBOSE_ERROR_MESSAGES=true                 # Include stack traces in error responses

# ============================================================================
# MONITORING & ANALYTICS
# ============================================================================
SENTRY_DSN=                                 # Sentry error tracking (optional)
DATADOG_API_KEY=                            # Datadog monitoring (optional)
NEW_RELIC_LICENSE_KEY=                      # New Relic monitoring (optional)

# ============================================================================
# BACKUP & MAINTENANCE
# ============================================================================
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 2 * * *                   # Cron format: 2 AM daily
BACKUP_RETENTION_DAYS=30                    # Keep 30 days of backups
BACKUP_DESTINATION=s3://mindbridge-backups

# Database maintenance
DB_OPTIMIZE_SCHEDULE=0 3 * * 0              # Cron format: 3 AM every Sunday
DB_CLEANUP_LOGS_OLDER_THAN_DAYS=90
